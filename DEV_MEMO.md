# DEV_MEMO.md

## 📅 2025.11.16 - Task 21: Feed 드래그 선택 → 오선지 표시

### 🎯 Development Spec 요약

1. 이 Task는 Feed 페이지에서 사용자가 마디를 드래그 선택하면 해당 구간의 오선지를 표시하는 기능을 구현합니다.
2. 핵심은 드래그 상태 관리와 VexFlow 렌더링을 통해 선택된 마디의 악보를 실시간으로 보여주는 것입니다.
3. Feed 컴포넌트와 VexFlow 유틸리티를 수정하며, 기존 디자인 시스템을 준수합니다.

---

## Step 1: 드래그 선택 UI 구현 (예상 1h)

### 📋 Claude 제안

**수정 파일:**
- `app/feed/page.tsx`: 드래그 상태 관리 및 선택 영역 표시
- `components/VexFlowRenderer.tsx`: 선택된 마디의 악보 렌더링
- `styles/feed.css`: 드래그 선택 시각적 피드백

**핵심 로직:**
1. useState로 dragStart, dragEnd 상태 관리
2. onMouseDown/onMouseMove/onMouseUp 이벤트로 드래그 감지
3. 선택된 마디 범위 계산 및 하이라이트 표시
4. VexFlow로 해당 구간 악보 렌더링

**완료 조건:**
- [ ] 마디를 드래그하면 선택 영역이 시각적으로 표시됨
- [ ] 선택된 마디의 악보가 VexFlow로 렌더링됨
- [ ] 다른 영역 클릭 시 선택 해제됨

**예상 이슈:**
- VexFlow 렌더링 성능 최적화 필요할 수 있음
- 모바일 터치 이벤트 별도 처리 필요

**참고 문서:**
- 2.10.1 기본화면 구성: FEED 화면 기능 정의서
- VexFlow 공식 문서

---

### 🔍 Gemini 검토

**✅ 긍정 포인트:**
- 상태 관리 방식이 React 베스트 프랙티스를 따름
- VexFlow 사용이 적절하고 기존 코드와 일관성 있음
- 완료 조건이 명확하게 정의됨

**⚠️ 우려 사항:**
- 드래그 중 리렌더링이 과도하게 발생할 수 있음
- 터치 이벤트 처리가 명시되지 않아 모바일에서 작동 안 할 가능성
- VexFlow 인스턴스 메모리 관리 명시 필요

**💡 개선 제안:**
- useMemo/useCallback으로 렌더링 최적화
- react-use-gesture 라이브러리 고려
- VexFlow 인스턴스 cleanup useEffect 추가

**📊 종합 의견:**
- [x] 승인 권장
- [ ] 수정 필요

전반적으로 구현 방향이 타당하나, 성능 최적화와 모바일 지원을 염두에 두고 진행하면 좋을 것 같습니다.

---

### ✅ Claude 최종 판단

**상태:** 승인

**판단 근거:**

Gemini가 제기한 우려사항들을 검토한 결과, 모두 구현 과정에서 점진적으로 해결 가능한 사항들입니다:

1. **리렌더링 성능**: 기본 구현 완료 후 프로파일링을 통해 필요시 useMemo/useCallback 적용 가능
2. **모바일 터치 이벤트**: 중요한 지적이나 데스크톱 우선 구현 후 추가 작업으로 처리 가능
3. **메모리 관리**: cleanup useEffect는 VexFlow 렌더링 시 기본적으로 적용 예정

제안된 react-use-gesture 라이브러리는 현 단계에서 과도한 의존성 추가로 판단되며, 네이티브 이벤트 핸들러로 충분히 구현 가능합니다.

**합의 포인트:**
- React 베스트 프랙티스 준수
- 기존 코드와의 일관성 유지
- 명확한 완료 조건 설정
- Development Spec 요구사항 충족

구현 방향이 타당하며 Gemini의 제안사항들은 구현 시 참고하여 적용하겠습니다.
