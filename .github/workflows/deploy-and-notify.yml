name: Deploy and Notify

on:
  deployment_status:

jobs:
  notify-deployment:
    runs-on: ubuntu-latest
    if: github.event.deployment_status.state == 'success'

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Extract Task and Week Number
        id: task
        run: |
          # Extract task and week number from commit message (first line only)
          # Format: [WXX] Task X.Y: type - description
          COMMIT_MSG=$(git log -1 --pretty=%s)
          echo "Debug: Commit message is '$COMMIT_MSG'"

          # Week ë²ˆí˜¸ ì¶”ì¶œ (ì˜ˆ: [W05] -> W05, ì‹¤íŒ¨ ì‹œ "none")
          WEEK_NUM=$(echo "$COMMIT_MSG" | grep -oP '\[W\d+\]' | head -1 | tr -d '[]')
          if [ -z "$WEEK_NUM" ]; then
            WEEK_NUM="none"
          fi
          echo "Debug: Extracted WEEK_NUM is '$WEEK_NUM'"

          # Task ë²ˆí˜¸ ì¶”ì¶œ (ì‹¤íŒ¨ ì‹œ "none" ë°˜í™˜, "0"ë„ ìœ íš¨í•œ Task)
          TASK_NUM=$(echo "$COMMIT_MSG" | grep -o 'Task [0-9.]\+' | head -1 | sed 's/Task //')
          if [ -z "$TASK_NUM" ]; then
            TASK_NUM="none"
          fi
          echo "Debug: Extracted TASK_NUM is '$TASK_NUM'"
          {
            echo "week_number=$WEEK_NUM"
            echo "task_number=$TASK_NUM"
            echo "commit_message<<EOF"
            echo "$COMMIT_MSG"
            echo "EOF"
          } >> $GITHUB_OUTPUT

      - name: Get Commit Info
        id: commit
        run: |
          COMMIT_SHA=$(git rev-parse --short HEAD)
          COMMIT_TIME=$(git log -1 --format=%cd --date=format:'%Y-%m-%d %H:%M:%S')
          echo "sha=$COMMIT_SHA" >> $GITHUB_OUTPUT
          echo "time=$COMMIT_TIME" >> $GITHUB_OUTPUT

      - name: Clean Old Task Logs from Context Hub
        id: clean_logs
        continue-on-error: true
        if: steps.task.outputs.task_number != 'none'
        env:
          NOTION_API_KEY: ${{ secrets.NOTION_API_KEY }}
          CONTEXT_HUB_PAGE_ID: ${{ secrets.CONTEXT_HUB_PAGE_ID }}
          TASK_NUMBER: ${{ steps.task.outputs.task_number }}
        run: |
          echo "ğŸ” Checking existing logs in Context Hub..."

          # í˜„ì¬ Taskì˜ ì •ìˆ˜ ë¶€ë¶„ ì¶”ì¶œ (0.1 -> 0, 1.2 -> 1)
          CURRENT_TASK_INT=$(echo "$TASK_NUMBER" | cut -d'.' -f1)
          echo "Current Task (integer part): $CURRENT_TASK_INT"

          # í˜ì´ì§€ ë¸”ë¡ë“¤ ì¡°íšŒ
          BLOCKS_RESPONSE=$(curl -s -X GET "https://api.notion.com/v1/blocks/${CONTEXT_HUB_PAGE_ID}/children?page_size=100" \
            -H "Authorization: Bearer ${NOTION_API_KEY}" \
            -H "Notion-Version: 2022-06-28")

          # ë¡œê·¸ ë¸”ë¡ í•„í„°ë§ ë° ì‚­ì œ
          DELETED_COUNT=0
          BLOCK_IDS=$(echo "$BLOCKS_RESPONSE" | jq -r '.results[] | select(.type == "paragraph") | select(.paragraph.rich_text[0].text.content | startswith("âœ… [")) | .id')

          for BLOCK_ID in $BLOCK_IDS; do
            # í•´ë‹¹ ë¸”ë¡ì˜ í…ìŠ¤íŠ¸ì—ì„œ Task ë²ˆí˜¸ ì¶”ì¶œ
            BLOCK_TEXT=$(echo "$BLOCKS_RESPONSE" | jq -r --arg id "$BLOCK_ID" '.results[] | select(.id == $id) | .paragraph.rich_text[0].text.content')
            BLOCK_TASK=$(echo "$BLOCK_TEXT" | grep -oP 'Task \K[0-9]+' | head -1)

            echo "Found log block: Task $BLOCK_TASK (Block ID: $BLOCK_ID)"

            # Task ë²ˆí˜¸ê°€ ë‹¤ë¥´ë©´ ì‚­ì œ
            if [ -n "$BLOCK_TASK" ] && [ "$BLOCK_TASK" != "$CURRENT_TASK_INT" ]; then
              echo "ğŸ—‘ï¸ Deleting old Task $BLOCK_TASK log..."
              DELETE_RESPONSE=$(curl -s -w "\n%{http_code}" -X DELETE "https://api.notion.com/v1/blocks/${BLOCK_ID}" \
                -H "Authorization: Bearer ${NOTION_API_KEY}" \
                -H "Notion-Version: 2022-06-28")

              DELETE_CODE=$(echo "$DELETE_RESPONSE" | tail -n1)
              if [ "$DELETE_CODE" = "200" ]; then
                DELETED_COUNT=$((DELETED_COUNT + 1))
                echo "âœ… Deleted successfully"
              else
                echo "âš ï¸ Failed to delete (HTTP $DELETE_CODE)"
              fi

              # Rate limit ë°©ì§€
              sleep 0.3
            fi
          done

          echo "ğŸ§¹ Cleaned up $DELETED_COUNT old log(s)"
          echo "deleted_count=$DELETED_COUNT" >> $GITHUB_OUTPUT

      - name: Update Notion Context Hub
        id: notion
        continue-on-error: true
        if: steps.task.outputs.task_number != 'none'
        env:
          NOTION_API_KEY: ${{ secrets.NOTION_API_KEY }}
          CONTEXT_HUB_PAGE_ID: ${{ secrets.CONTEXT_HUB_PAGE_ID }}
          TASK_NUMBER: ${{ steps.task.outputs.task_number }}
          COMMIT_SHA: ${{ steps.commit.outputs.sha }}
          COMMIT_TIME: ${{ steps.commit.outputs.time }}
          COMMIT_MESSAGE: ${{ steps.task.outputs.commit_message }}
        run: |
          echo "ğŸ“ Updating Notion Context Hub..."

          # ì™„ë£Œ ë¡œê·¸ ë©”ì‹œì§€ ìƒì„±
          LOG_MESSAGE="âœ… [${COMMIT_TIME}] Task ${TASK_NUMBER} ì™„ë£Œ - ${COMMIT_MESSAGE} (${COMMIT_SHA})"
          echo "Log message: $LOG_MESSAGE"

          # Notion API í˜¸ì¶œ - Context Hub í˜ì´ì§€ í•˜ë‹¨ì— ë¡œê·¸ ì¶”ê°€
          RESPONSE=$(curl -s -w "\n%{http_code}" -X PATCH "https://api.notion.com/v1/blocks/${CONTEXT_HUB_PAGE_ID}/children" \
            -H "Authorization: Bearer ${NOTION_API_KEY}" \
            -H "Content-Type: application/json" \
            -H "Notion-Version: 2022-06-28" \
            -d '{
              "children": [
                {
                  "object": "block",
                  "type": "paragraph",
                  "paragraph": {
                    "rich_text": [
                      {
                        "type": "text",
                        "text": {
                          "content": "'"${LOG_MESSAGE}"'"
                        }
                      }
                    ]
                  }
                }
              ]
            }')

          HTTP_CODE=$(echo "$RESPONSE" | tail -n1)
          BODY=$(echo "$RESPONSE" | sed '$d')

          if [ "$HTTP_CODE" = "200" ]; then
            echo "âœ… Context Hub ì—…ë°ì´íŠ¸ ì„±ê³µ!"
            echo "updated=true" >> $GITHUB_OUTPUT
          else
            echo "âš ï¸ Context Hub ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ (HTTP $HTTP_CODE)"
            echo "Response: $BODY"
            echo "updated=false" >> $GITHUB_OUTPUT
          fi

      - name: Update Phase Status in Context Hub
        id: phase_update
        continue-on-error: true
        if: steps.task.outputs.task_number != 'none'
        env:
          NOTION_API_KEY: ${{ secrets.NOTION_API_KEY }}
          CONTEXT_HUB_PAGE_ID: ${{ secrets.CONTEXT_HUB_PAGE_ID }}
          COMMIT_MESSAGE: ${{ steps.task.outputs.commit_message }}
        run: |
          echo "ğŸ” Checking for Phase number in commit message..."

          # Phase ë²ˆí˜¸ ì¶”ì¶œ (Task X.Yì—ì„œ Y ì¶”ì¶œ)
          PHASE_NUM=$(echo "$COMMIT_MESSAGE" | grep -oP 'Task \d+\.(\d+):' | grep -oP '\.\d+' | tr -d '.')

          if [ -z "$PHASE_NUM" ]; then
            echo "â„¹ï¸ No Phase number found, skipping Phase update"
            echo "phase_updated=false" >> $GITHUB_OUTPUT
            exit 0
          fi

          echo "ğŸ“Œ Found Phase $PHASE_NUM, updating Context Hub..."

          # í˜ì´ì§€ ë¸”ë¡ë“¤ ì¡°íšŒ
          BLOCKS_RESPONSE=$(curl -s -X GET "https://api.notion.com/v1/blocks/${CONTEXT_HUB_PAGE_ID}/children?page_size=100" \
            -H "Authorization: Bearer ${NOTION_API_KEY}" \
            -H "Notion-Version: 2022-06-28")

          UPDATED_COUNT=0

          # 1. paragraph ë¸”ë¡ì—ì„œ "â³ Phase N:" ì°¾ì•„ì„œ "âœ… Phase N:"ìœ¼ë¡œ ë³€ê²½
          echo "ğŸ”„ Searching for paragraph blocks with â³ Phase ${PHASE_NUM}..."
          PARAGRAPH_BLOCKS=$(echo "$BLOCKS_RESPONSE" | jq -r --arg phase "Phase ${PHASE_NUM}" '.results[] | select(.type == "paragraph") | select(.paragraph.rich_text[0].text.content | contains($phase)) | .id')

          for BLOCK_ID in $PARAGRAPH_BLOCKS; do
            BLOCK_TEXT=$(echo "$BLOCKS_RESPONSE" | jq -r --arg id "$BLOCK_ID" '.results[] | select(.id == $id) | .paragraph.rich_text[0].text.content')

            # â³ê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ ì—…ë°ì´íŠ¸
            if echo "$BLOCK_TEXT" | grep -q "â³ Phase ${PHASE_NUM}"; then
              NEW_TEXT=$(echo "$BLOCK_TEXT" | sed "s/â³ Phase ${PHASE_NUM}/âœ… Phase ${PHASE_NUM}/g")
              echo "Updating paragraph: $BLOCK_TEXT -> $NEW_TEXT"

              UPDATE_RESPONSE=$(curl -s -w "\n%{http_code}" -X PATCH "https://api.notion.com/v1/blocks/${BLOCK_ID}" \
                -H "Authorization: Bearer ${NOTION_API_KEY}" \
                -H "Content-Type: application/json" \
                -H "Notion-Version: 2022-06-28" \
                -d '{
                  "paragraph": {
                    "rich_text": [
                      {
                        "type": "text",
                        "text": {
                          "content": "'"${NEW_TEXT}"'"
                        }
                      }
                    ]
                  }
                }')

              UPDATE_CODE=$(echo "$UPDATE_RESPONSE" | tail -n1)
              if [ "$UPDATE_CODE" = "200" ]; then
                UPDATED_COUNT=$((UPDATED_COUNT + 1))
                echo "âœ… Paragraph updated successfully"
              else
                echo "âš ï¸ Failed to update paragraph (HTTP $UPDATE_CODE)"
              fi
              sleep 0.3
            fi
          done

          # 2. to_do ë¸”ë¡ì—ì„œ "Phase N:" ì°¾ì•„ì„œ checked: trueë¡œ ë³€ê²½
          echo "ğŸ”„ Searching for to_do blocks with Phase ${PHASE_NUM}..."
          TODO_BLOCKS=$(echo "$BLOCKS_RESPONSE" | jq -r --arg phase "Phase ${PHASE_NUM}" '.results[] | select(.type == "to_do") | select(.to_do.rich_text[0].text.content | contains($phase)) | select(.to_do.checked == false) | .id')

          for BLOCK_ID in $TODO_BLOCKS; do
            BLOCK_TEXT=$(echo "$BLOCKS_RESPONSE" | jq -r --arg id "$BLOCK_ID" '.results[] | select(.id == $id) | .to_do.rich_text[0].text.content')
            echo "Checking to_do: $BLOCK_TEXT"

            UPDATE_RESPONSE=$(curl -s -w "\n%{http_code}" -X PATCH "https://api.notion.com/v1/blocks/${BLOCK_ID}" \
              -H "Authorization: Bearer ${NOTION_API_KEY}" \
              -H "Content-Type: application/json" \
              -H "Notion-Version: 2022-06-28" \
              -d '{
                "to_do": {
                  "checked": true
                }
              }')

            UPDATE_CODE=$(echo "$UPDATE_RESPONSE" | tail -n1)
            if [ "$UPDATE_CODE" = "200" ]; then
              UPDATED_COUNT=$((UPDATED_COUNT + 1))
              echo "âœ… To-do checked successfully"
            else
              echo "âš ï¸ Failed to update to_do (HTTP $UPDATE_CODE)"
            fi
            sleep 0.3
          done

          # 3. has_children=trueì¸ ë¸”ë¡ì˜ ìì‹ì—ì„œ bulleted_list_item ê²€ìƒ‰
          echo "ğŸ”„ Searching for nested bulleted_list_item blocks..."
          PARENT_BLOCKS=$(echo "$BLOCKS_RESPONSE" | jq -r '.results[] | select(.has_children == true) | .id')

          for PARENT_ID in $PARENT_BLOCKS; do
            CHILDREN_RESPONSE=$(curl -s -X GET "https://api.notion.com/v1/blocks/${PARENT_ID}/children?page_size=100" \
              -H "Authorization: Bearer ${NOTION_API_KEY}" \
              -H "Notion-Version: 2022-06-28")

            # bulleted_list_itemì—ì„œ Phase ê²€ìƒ‰
            BULLET_BLOCKS=$(echo "$CHILDREN_RESPONSE" | jq -r --arg phase "Phase ${PHASE_NUM}" \
              '.results[] | select(.type == "bulleted_list_item") | select(.bulleted_list_item.rich_text[0].text.content | contains($phase)) | .id' 2>/dev/null)

            for BLOCK_ID in $BULLET_BLOCKS; do
              BLOCK_TEXT=$(echo "$CHILDREN_RESPONSE" | jq -r --arg id "$BLOCK_ID" \
                '.results[] | select(.id == $id) | .bulleted_list_item.rich_text[0].text.content')

              if echo "$BLOCK_TEXT" | grep -q "â³ Phase ${PHASE_NUM}"; then
                NEW_TEXT=$(echo "$BLOCK_TEXT" | sed "s/â³ Phase ${PHASE_NUM}/âœ… Phase ${PHASE_NUM}/g")
                echo "Updating bulleted_list_item: $BLOCK_TEXT -> $NEW_TEXT"

                UPDATE_RESPONSE=$(curl -s -w "\n%{http_code}" -X PATCH "https://api.notion.com/v1/blocks/${BLOCK_ID}" \
                  -H "Authorization: Bearer ${NOTION_API_KEY}" \
                  -H "Content-Type: application/json" \
                  -H "Notion-Version: 2022-06-28" \
                  -d '{
                    "bulleted_list_item": {
                      "rich_text": [{"type": "text", "text": {"content": "'"${NEW_TEXT}"'"}}]
                    }
                  }')

                UPDATE_CODE=$(echo "$UPDATE_RESPONSE" | tail -n1)
                if [ "$UPDATE_CODE" = "200" ]; then
                  UPDATED_COUNT=$((UPDATED_COUNT + 1))
                  echo "âœ… Bulleted list item updated successfully"
                else
                  echo "âš ï¸ Failed to update bulleted_list_item (HTTP $UPDATE_CODE)"
                fi
                sleep 0.3
              fi
            done

            # ìì‹ ë¸”ë¡ì˜ to_doë„ ê²€ìƒ‰
            CHILD_TODO_BLOCKS=$(echo "$CHILDREN_RESPONSE" | jq -r --arg phase "Phase ${PHASE_NUM}" \
              '.results[] | select(.type == "to_do") | select(.to_do.rich_text[0].text.content | contains($phase)) | select(.to_do.checked == false) | .id' 2>/dev/null)

            for BLOCK_ID in $CHILD_TODO_BLOCKS; do
              BLOCK_TEXT=$(echo "$CHILDREN_RESPONSE" | jq -r --arg id "$BLOCK_ID" \
                '.results[] | select(.id == $id) | .to_do.rich_text[0].text.content')
              echo "Checking nested to_do: $BLOCK_TEXT"

              UPDATE_RESPONSE=$(curl -s -w "\n%{http_code}" -X PATCH "https://api.notion.com/v1/blocks/${BLOCK_ID}" \
                -H "Authorization: Bearer ${NOTION_API_KEY}" \
                -H "Content-Type: application/json" \
                -H "Notion-Version: 2022-06-28" \
                -d '{
                  "to_do": {
                    "checked": true
                  }
                }')

              UPDATE_CODE=$(echo "$UPDATE_RESPONSE" | tail -n1)
              if [ "$UPDATE_CODE" = "200" ]; then
                UPDATED_COUNT=$((UPDATED_COUNT + 1))
                echo "âœ… Nested to-do checked successfully"
              else
                echo "âš ï¸ Failed to update nested to_do (HTTP $UPDATE_CODE)"
              fi
              sleep 0.3
            done

            sleep 0.3
          done

          echo "ğŸ“Š Updated $UPDATED_COUNT block(s) for Phase $PHASE_NUM"
          echo "phase_updated=true" >> $GITHUB_OUTPUT
          echo "phase_number=$PHASE_NUM" >> $GITHUB_OUTPUT

      - name: Update Codebase State in Context Hub
        id: codebase_state
        continue-on-error: true
        if: steps.task.outputs.task_number != 'none'
        env:
          NOTION_API_KEY: ${{ secrets.NOTION_API_KEY }}
          CONTEXT_HUB_PAGE_ID: ${{ secrets.CONTEXT_HUB_PAGE_ID }}
          COMMIT_MESSAGE: ${{ steps.task.outputs.commit_message }}
          COMMIT_TIME: ${{ steps.commit.outputs.time }}
        run: |
          echo "ğŸ“Š Updating Codebase State (bulleted_list_item)..."

          # í˜„ì¬ ë‚ ì§œ (ë°°í¬ì¼)
          DEPLOY_DATE=$(echo "$COMMIT_TIME" | cut -d' ' -f1)
          echo "Deploy date: $DEPLOY_DATE"

          # ì»¤ë°‹ ë©”ì‹œì§€ì—ì„œ íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„
          ESCAPED_MSG=$(echo "$COMMIT_MESSAGE" | sed 's/"/\\"/g' | head -c 100)
          echo "Commit message: $ESCAPED_MSG"

          # í˜ì´ì§€ ë¸”ë¡ë“¤ ì¡°íšŒ
          BLOCKS_RESPONSE=$(curl -s -X GET "https://api.notion.com/v1/blocks/${CONTEXT_HUB_PAGE_ID}/children?page_size=100" \
            -H "Authorization: Bearer ${NOTION_API_KEY}" \
            -H "Notion-Version: 2022-06-28")

          UPDATED_COUNT=0

          # bulleted_list_itemì—ì„œ "ë§ˆì§€ë§‰ ì»¤ë°‹:" ì°¾ê¸°
          COMMIT_BLOCK_ID=$(echo "$BLOCKS_RESPONSE" | jq -r '.results[] | select(.type == "bulleted_list_item") | select(.bulleted_list_item.rich_text[0].text.content | startswith("ë§ˆì§€ë§‰ ì»¤ë°‹:")) | .id' | head -1)
          if [ -n "$COMMIT_BLOCK_ID" ] && [ "$COMMIT_BLOCK_ID" != "null" ]; then
            echo "Found ë§ˆì§€ë§‰ ì»¤ë°‹ block: $COMMIT_BLOCK_ID"
            NEW_COMMIT_TEXT="ë§ˆì§€ë§‰ ì»¤ë°‹: ${ESCAPED_MSG}"

            curl -s -X PATCH "https://api.notion.com/v1/blocks/${COMMIT_BLOCK_ID}" \
              -H "Authorization: Bearer ${NOTION_API_KEY}" \
              -H "Content-Type: application/json" \
              -H "Notion-Version: 2022-06-28" \
              -d '{
                "bulleted_list_item": {
                  "rich_text": [{"type": "text", "text": {"content": "'"${NEW_COMMIT_TEXT}"'"}}]
                }
              }' > /dev/null
            echo "âœ… 'ë§ˆì§€ë§‰ ì»¤ë°‹' updated"
            UPDATED_COUNT=$((UPDATED_COUNT + 1))
            sleep 0.3
          else
            echo "âš ï¸ 'ë§ˆì§€ë§‰ ì»¤ë°‹' block not found"
          fi

          # bulleted_list_itemì—ì„œ "ë§ˆì§€ë§‰ ë°°í¬:" ì°¾ê¸°
          DEPLOY_BLOCK_ID=$(echo "$BLOCKS_RESPONSE" | jq -r '.results[] | select(.type == "bulleted_list_item") | select(.bulleted_list_item.rich_text[0].text.content | startswith("ë§ˆì§€ë§‰ ë°°í¬:")) | .id' | head -1)
          if [ -n "$DEPLOY_BLOCK_ID" ] && [ "$DEPLOY_BLOCK_ID" != "null" ]; then
            echo "Found ë§ˆì§€ë§‰ ë°°í¬ block: $DEPLOY_BLOCK_ID"
            NEW_DEPLOY_TEXT="ë§ˆì§€ë§‰ ë°°í¬: ${DEPLOY_DATE}"

            curl -s -X PATCH "https://api.notion.com/v1/blocks/${DEPLOY_BLOCK_ID}" \
              -H "Authorization: Bearer ${NOTION_API_KEY}" \
              -H "Content-Type: application/json" \
              -H "Notion-Version: 2022-06-28" \
              -d '{
                "bulleted_list_item": {
                  "rich_text": [{"type": "text", "text": {"content": "'"${NEW_DEPLOY_TEXT}"'"}}]
                }
              }' > /dev/null
            echo "âœ… 'ë§ˆì§€ë§‰ ë°°í¬' updated"
            UPDATED_COUNT=$((UPDATED_COUNT + 1))
          else
            echo "âš ï¸ 'ë§ˆì§€ë§‰ ë°°í¬' block not found"
          fi

          echo "ğŸ“Š Codebase State update complete ($UPDATED_COUNT blocks updated)"

      - name: Send Slack Notification
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
          DEPLOYMENT_URL: ${{ github.event.deployment_status.target_url }}
          TASK_NUMBER: ${{ steps.task.outputs.task_number }}
          COMMIT_SHA: ${{ steps.commit.outputs.sha }}
          COMMIT_TIME: ${{ steps.commit.outputs.time }}
          COMMIT_MESSAGE: ${{ steps.task.outputs.commit_message }}
          CONTEXT_HUB_UPDATED: ${{ steps.notion.outputs.updated }}
        run: |
          echo "Debug: TASK_NUMBER before Slack notification is '$TASK_NUMBER'"
          if [ -n "$TASK_NUMBER" ] && [ "$TASK_NUMBER" != "none" ]; then
            TASK_TITLE="Task ${TASK_NUMBER}"
          else
            TASK_TITLE="ë°°í¬"
          fi

          # Context Hub ì—…ë°ì´íŠ¸ ìƒíƒœ ë©”ì‹œì§€
          if [ "$CONTEXT_HUB_UPDATED" = "true" ]; then
            CONTEXT_HUB_STATUS="ğŸ”— Context Hub ì—…ë°ì´íŠ¸ë¨"
          elif [ "$TASK_NUMBER" = "none" ]; then
            CONTEXT_HUB_STATUS="â„¹ï¸ Task ì—†ìŒ - Context Hub ìŠ¤í‚µ"
          else
            CONTEXT_HUB_STATUS="âš ï¸ Context Hub ì—…ë°ì´íŠ¸ ì‹¤íŒ¨"
          fi

          curl -X POST "$SLACK_WEBHOOK_URL" \
            -H 'Content-Type: application/json' \
            -d '{
              "text": "ğŸš€ ë°°í¬ ì™„ë£Œ: '"${TASK_TITLE}"'",
              "blocks": [
                {
                  "type": "header",
                  "text": {
                    "type": "plain_text",
                    "text": "ğŸš€ ë°°í¬ ì™„ë£Œ: '"${TASK_TITLE}"'",
                    "emoji": true
                  }
                },
                {
                  "type": "divider"
                },
                {
                  "type": "section",
                  "fields": [
                    {
                      "type": "mrkdwn",
                      "text": "ğŸ“¦ *ì»¤ë°‹*\n`'"${COMMIT_SHA}"'`"
                    },
                    {
                      "type": "mrkdwn",
                      "text": "â° *ì‹œê°*\n'"${COMMIT_TIME}"'"
                    }
                  ]
                },
                {
                  "type": "section",
                  "fields": [
                    {
                      "type": "mrkdwn",
                      "text": "ğŸŒ *URL*\n<'"${DEPLOYMENT_URL}"'|ë°°í¬ í™•ì¸>"
                    },
                    {
                      "type": "mrkdwn",
                      "text": "ğŸ’¬ *ë©”ì‹œì§€*\n'"${COMMIT_MESSAGE}"'"
                    }
                  ]
                },
                {
                  "type": "section",
                  "text": {
                    "type": "mrkdwn",
                    "text": "'"${CONTEXT_HUB_STATUS}"'"
                  }
                },
                {
                  "type": "divider"
                },
                {
                  "type": "context",
                  "elements": [
                    {
                      "type": "mrkdwn",
                      "text": "âœ… Task ì™„ë£Œ ì‹œ ğŸ‘ ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”"
                    }
                  ]
                }
              ]
            }'
